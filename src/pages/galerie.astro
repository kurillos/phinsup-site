---
import Layout from '../layouts/BaseLayout.astro';

const photos = [
  { src: "/images/fanclub/1.jpeg", size: "tall", caption: "Rassemblement au bar officiel - Paris" },
  { src: "/images/fanclub/2.jpeg", size: "wide", caption: "Le drapeau Phins Up au match de Francfort" },
  { src: "/images/fanclub/3.jpeg", size: "square", caption: "La team au grand complet" },
  { src: "/images/fanclub/4.jpeg", size: "tall", caption: "Stand officiel du Fan Club au Hard Rock Stadium" },
  { src: "/images/fanclub/5.jpeg", size: "tall", caption: "Bateau à Miami" },
  { src: "/images/fanclub/6.jpeg", size: "tall", caption: "Soirée à Miami" },
  { src: "/images/fanclub/7.jpeg", size: "tall", caption: "Rassemblement à Londres contre les Jaguars" },
];
---

<Layout title="Galerie & Fan Club - The Phin Side">
  <main class="max-w-7xl mx-auto py-12 px-6">
    
    <section class="mb-20 bg-gray-900 rounded-3xl overflow-hidden shadow-2xl flex flex-col md:flex-row border-b-8 border-miami-aqua">
        <div class="p-8 md:p-12 md:w-2/3">
            <h1 class="text-5xl font-[Oswald] font-black italic uppercase text-white mb-6">
                Le Fan Club <span class="text-miami-aqua text-3xl block">Dolfans France</span>
            </h1>
            <p class="text-gray-300 leading-relaxed mb-6 italic">
                Le FCFRMD (Fan Club Français des Miami Dolphins) est la communauté officielle des supporters francophones des Miami Dolphins.<br>

                Créé en 2017 par Lucas ROC et Yanis DANEZ, le fan-club est né d’une passion commune pour la franchise floridienne et de la volonté de rassembler les fans français autour des valeurs et de l’histoire des Dolphins. Depuis sa création, le FCFRMD n’a cessé de grandir et a obtenu une reconnaissance officielle de la part de la franchise, une fierté pour toute la communauté.<br>

                Le fan-club regroupe aujourd’hui plus d’une centaine de membres investis et passionnés. Nous partageons ensemble l’actualité de l’équipe, analysons les matchs, échangeons autour de la NFL et faisons vivre l’esprit Dolphins en France.<br>

                Le FCFRMD organise régulièrement des événements, des rassemblements pour les matchs, ainsi que des déplacements en Europe lors de la venue de l’équipe, mais également à Miami afin de vivre l’expérience au plus près du Hard Rock Stadium et de l’ambiance unique des jours de match.<br>

                Rejoindre le FCFRMD, c’est intégrer une communauté dynamique, conviviale et engagée, unie par la même passion pour les Dolphins.  
            </p>
            <div class="flex gap-4">
                <span class="bg-miami-orange text-white px-4 py-2 rounded-full font-bold text-xs uppercase italic shadow-lg">Est. 2017</span>
                <span class="bg-white/10 text-white px-4 py-2 rounded-full font-bold text-xs uppercase italic border border-white/20">Paris & Province</span>
            </div>
        </div>
        <div class="md:w-1/3 bg-miami-aqua flex items-center justify-center p-8">
            <img src="/logofr.png" alt="Logo Fan Club" class="w-48 h-auto drop-shadow-2xl animate-pulse" />
        </div>
    </section>

    <div class="grid-masonry">
      {photos.map((photo, index) => (
        <div 
            class={`gallery-item ${photo.size} group relative overflow-hidden rounded-2xl shadow-lg cursor-zoom-in`}
            data-index={index}
        >
          <img 
            src={photo.src} 
            alt={photo.caption} 
            class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 pointer-events-none"
          />
          <div class="absolute inset-0 bg-linear-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity p-6 flex items-end">
            <span class="text-white font-[Oswald] italic uppercase tracking-wider">{photo.caption}</span>
          </div>
        </div>
      ))}
    </div>

    <div id="carousel-modal" class="fixed inset-0 z-100 bg-black/95 flex justify-center items-center backdrop-blur-md">
    <button id="close-modal" class="absolute top-6 right-6 text-white text-5xl font-light hover:text-miami-orange z-110 transition-colors">&times;</button>
    
    <button id="prev-photo" class="nav-btn left-4 md:left-10">‹</button>
    <button id="next-photo" class="nav-btn right-4 md:right-10">›</button>

    <div class="flex flex-col items-center justify-center w-full h-full p-4">
        <div class="relative max-w-5xl max-h-[80vh] flex items-center justify-center">
            <img id="modal-img" src="" class="max-w-full max-h-[80vh] object-contain rounded shadow-2xl border border-white/10" />
        </div>
        <p id="modal-caption" class="font-[Oswald] italic uppercase mt-6 text-lg md:text-2xl text-center tracking-[0.2em] text-miami-aqua px-4"></p>
    </div>
</div>

<style>
  /* Masonry existant... */
  .grid-masonry {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    grid-auto-rows: 220px;
    grid-auto-flow: dense;
    gap: 20px;
  }

  /* Style des flèches pour un centrage vertical parfait */
  .nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%); /* C'est ça qui centre verticalement */
    color: white;
    font-size: 5rem;
    font-weight: 100;
    z-index: 110;
    transition: all 0.3s ease;
    padding: 0 20px;
    user-select: none;
  }
  .nav-btn:hover { color: #008E97; scale: 1.2; } /* Miami Aqua */

  /* Empêche le clic sur l'image de fermer le modal, mais permet au fond noir de le faire */
  #modal-img { pointer-events: auto; }
</style>

<script>
  // 1. On cible les éléments avec l'assertion "!" car on sait qu'ils sont dans le HTML
  const modal = document.getElementById('carousel-modal')!;
  const modalImg = document.getElementById('modal-img') as HTMLImageElement;
  const modalCaption = document.getElementById('modal-caption')!;
  const nextBtn = document.getElementById('next-photo')!;
  const prevBtn = document.getElementById('prev-photo')!;
  const closeBtn = document.getElementById('close-modal')!;

  // 2. Récupération robuste des données des photos
  const photoElements = document.querySelectorAll('.gallery-item img');
  const photos = Array.from(photoElements).map(img => {
    const htmlImg = img as HTMLImageElement;
    return {
      src: htmlImg.src || '',
      caption: htmlImg.alt || ''
    };
  });

  let currentIndex = 0;

  // 3. Mise à jour du modal avec typage de l'index
  function updateModal(index: number) {
    if (!photos[index]) return;
    currentIndex = index;
    modalImg.src = photos[index].src;
    modalCaption.textContent = photos[index].caption;
  }

  // 4. Ouverture
  document.querySelectorAll('.gallery-item').forEach((item, index) => {
    item.addEventListener('click', () => {
      updateModal(index);
      modal.classList.remove('hidden');
      modal.classList.add('flex'); // Pour s'assurer que le centrage CSS fonctionne
      document.body.style.overflow = 'hidden';
    });
  });

  // 5. Fonctions de fermeture
  const closeModal = () => {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = 'auto';
  };

  closeBtn.addEventListener('click', closeModal);
  
  // Fermer au clic sur le fond (uniquement si on clique sur le modal lui-même)
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  // 6. Navigation
  nextBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    currentIndex = (currentIndex + 1) % photos.length;
    updateModal(currentIndex);
  });

  prevBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    currentIndex = (currentIndex - 1 + photos.length) % photos.length;
    updateModal(currentIndex);
  });

  // 7. Contrôles au clavier
  window.addEventListener('keydown', (e) => {
    if (modal.classList.contains('hidden')) return;

    if (e.key === 'Escape') closeModal();
    if (e.key === 'ArrowRight') {
      currentIndex = (currentIndex + 1) % photos.length;
      updateModal(currentIndex);
    }
    if (e.key === 'ArrowLeft') {
      currentIndex = (currentIndex - 1 + photos.length) % photos.length;
      updateModal(currentIndex);
    }
  });
</script>